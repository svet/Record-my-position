=================================
Record my position: csv_to_kml.py
=================================

:author: Grzegorz Adam Hankiewicz <gradha@imap.cc>

.. contents::

.. section-numbering::

.. raw:: pdf

   PageBreak oneColumn

General
=======

This program transforms the CSV files generated by Record-my-position
(https://github.com/gradha/Record-my-position) into KML, KMZ or GPX
files which can be opened with Google Earth (http://earth.google.com/).
For more information see the Record-my-position package.


Usage
=====

Put your CSV files in a directory and run the ``csv_to_kml.py``
script on them::

    $ csv_to_kml.py *csv

That will generate a KMZ file for each CSV file. Run the script
with the ``-h`` switch to get help on more options, like compression
of the generated files.


Processing of CSV files
=======================

Discarding timestamps in the past
---------------------------------

Before generating the kml files some processing is done. First,
*backwards* positions are removed. Backwards positions are position
log entries which contain a timestamp **in the past**. This happens
because the iPhone doesn't necessarily give you a real time position.
Consider the following:

* You start the iPhone's GPS receiver.
* The iPhone's SDK starts feeding GPS locations with low accuracy.
* You disable the reception of GPS receiver.
* The iPhone is *smart* and keeps the GPS antenna on for a few
  seconds, possibly receiving a more accurate position in the next
  10 seconds.
* Some time elapses, then you turn on the GPS receiver again.
* Before anything else, the iPhone gives you the previously cached
  location value.

In this situation, the first value you get is really accurate but
is *in the past*. For practical purposes this entry is discarded.
Yes, it is more accurate, but it is useless: if you are using the
data in real time, the data didn't reach you when you needed it.
When you get it, it's old news anyway. Besides, you are not from
the past, are you?

Interpolation of log coordinates
--------------------------------

Textual log entries don't have a position, but for representation
purposes they get one using timestamp interpolation between the
previous and next valid coordinates. What will happen is that in
the generated map you will see a straight line of log only entries
between two valid but distant in time GPS positions.

Separation of tracks
--------------------

A single CSV file may contain different readings from different
days. In order to make the information somehow more manageable,
positions are grouped according to the timestamp. If one hour elapses
between two log entries, they will be separated in different groups.

GPX file output
---------------

All GPX files contain less information than their related CSV files
(eg. there are no notes or device status changes).  Still, the GPX
file format is more extended so it is more likely another program
will be able to process it rather than the custom CSV file. GPX
files produced by this conversion script are more ellaborate than
the GPX files produced on the iPhone because of the improvements
performed during the CSV processing.
